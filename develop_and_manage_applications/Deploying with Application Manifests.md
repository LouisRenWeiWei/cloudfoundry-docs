##使用部署清单部署应用

*此文章假设你使用的cf命令行工具(v6)*

应用程序部署清单告知```cf push```应该如何配置应用程序。包括需要创建的实例数量，需要分配的内存大小以及需要使用的所有服务。

部署清单文件能够帮助你做自动化的部署，是部署过程更为简单，特别是一次性部署多个应用程序的时候。

###cf push如何找到部署清单文件

默认情况下，```cf push```命令在部署应用程序的时候会在当前工作目录下寻找```manifest.xml```文件。也可以使用```-f```选项指定部署清单文件的路径跟文件名。

在使用```cf push```时，如果不提供```-f```选项，那么你必须在当前工作目录文件夹下提供一个名为```manifest.xml```的文件。

```
$ cf push
Using manifest file /path_to_working_directory/manifest.yml
```

使用```-f```选项，跟路径但不包含文件名时，此路径目录下必须存在名为```manifest.xml```的文件。

```
$ cf push -f ./some_directory/some_other_directory/
Using manifest file /path_to_working_directory/some_directory/some_other_directory/manifest.yml
```

如果部署清单文件名不是```manifest.xml```，在使用```-f```选项时，必须同时指定路径和 文件名。

```
$ cf push -f ./some_directory/some_other_directory/alternate_manifest.yml
Using manifest file /path_to_working_directory/some_directory/some_other_directory/alternate_manifest.yml
```

###部署清单例子

你可以在部署应用程序的时候不适用部署清单。使用部署清单的好处主要有保持每次部署的一致性和重用。如果你想应用程序的部署在不同云平台上兼容的话，部署清单文件就特别有用。

部署清单文件使用Yaml格式。下面的部署清单文件简要说明了Yaml的书写规范：

* 部署清单文件以三个中划线开始。
* 第一个```applications```配置后面跟随冒号。
* 应用程序的名称```name```以一个中划线和空格开始。
* 其他属性以两个空格开始与```name```对齐。

部署清单最小的配置只需要应用程序的名称```name```就够了。删除掉以上例子的```memory```和```host```配置只剩下```name```，它依然是一个合法的部署清单文件。

把```manifest```文件放在与应用程序文件的同一个目录下面，然后再执行```cf push```。如果你不适用```-p```参数指定应用程序路径的话，```cf push```会试图在当前文件夹下面寻找```manifest.xml```文件。

###cf push时总是提供应用程序名称

命令```cf push```需要应用程序名称，可以在部署清单文件或者命令行里面提供。

如[./Deploying with Application Manifests.md#cf push如何找到部署清单文件]上所述，命令```cf push```只有在文件```manifest.xml```存在于当前工作目录文件夹下才能工作。

如果你不适用部署清单文件，最简单的部署命令如下：

```
cf push my-app
```

> 注意：当在命令行提供应用程序的时候，```cf push```会使用此应用程序名称而不是部署清单文件里面的应用程序名称。如果部署清单文件里面配置了多个应用程序，在部署的时候你可以在命令行指定要部署的某个应用程序名称来部署单个应用程序，```cf```命令只会部署你指定的那个应用程序而不会部署其他的。在做测试的时候这些功能很有用。

###cf push如何找到应用程序

默认情况下，```cf push```会递归的部署当前工作目录文件夹下的所有内容。或者，你可以通过部署清单文件或者命令行选项指定一个要部署文件的路径。

* 如果路径指向某个目录，```cf push```就会递归的部署指定目录文件夹下的所有内容而不是当前目录。
* 如果路径指向某个文件，```cf push```就只会部署路径指定的文件。

>注意：如果你想部署多个文件但是又不是某个目录下的所有文件，你可以使用```.cfignore```文件配置在```cf push```执行时需要排除的文件。

###部署清单文件、命令行选项及最近一次部署默认值的优先级

当你第一次部署某个应用程序的时候，如果你没有使用部署清单文件或者```cf push```命令行选项的话，Cloud Foundry会给所有的属性设置默认值。

* 例如，在不提供部署清单文件情况下，执行```cf push my-app```部署应用程序到某个实例，在这种情况下，服务实例的数量为一，内存大小为1G。

多次部署过程中，那些属性值也可以改变。

* 例如，```cf scale```命令可以改变服务实例的数量。

任何时候，服务器上这些属性的值都是由默认值，部署清单中的值，```cf push```命令行中使用选项的值以及某些命令如```cf scale```修改后的值的组合。没有一个合适的名字来描述这些值的状态。你可以认为他们最近改变的值。

命令```cf push```在设置属性值时，遵循以下规则：

* 部署清单配置的值会覆盖掉最近改变的值以及任何默认的值。
* 命令行选项的值会覆盖掉部署清单配置的值。

一般来说，你可以认为部署清单文件就是```cf push```命令的另外一种输入配置方式，合并命令行选项以及最近改变的值。

###可选属性

此处讲解释如何在部署清单文件里面使用某些可选参数配置应用程序。任何一个可选属性都可以以命令行选项的方式提供。命令行选项会覆盖掉在部署清单文件中对应的属性值。

####buildpack属性

如果你的应用程序需要自定义的buildpack，你可以使用```buildpack```属性在制定其名称或者URL：

```
---
  ...
  buildpack: buildpack_URL
```

>注意：命令```cf buildpacks```列出所有你可以在部署清单文件或者命令行选项中可以使用的buildpack。

使用命令行选项覆盖buildpack的属性是```-b```。	
####命令行属性

某些开发语言或者框架需要使用自定义的命令在启动应用程序。是否需要提供自定义的启动参数，请参考[buildpack](http://docs.cloudfoundry.org/buildpacks/)文档。

你也可以在部署清单文件或者命令行选项中提供自定义的启动命令。

在应用程序的部署清单文件中添加特定的启动命令，在```command: START-COMMAND```上添加，如下：

```
---
  ...
  command: bundle exec rake VERBOSE=true
```

对于命令行选项，使用```-c```指定自定义的启动命令，如下：

```
$ cf push my-app -c "bundle exec rake VERBOSE=true"
```

>注意：在使用```cf push```命令时，如果```-c```选项值为‘null’，则会使用buildpack的启动命令。更多信息参考[关于启动应用](../cf_command_line_interface/About Starting Applications.md)

####磁盘配额属性

使用```disk_quota```属性指定需要给应用实例分配的磁盘大小。需要同时给定单位：```M```，```MB```，```G```或者```GB```，大小写都可以。

```
---
  ...
  disk_quota: 1024M
```

在命令行选项里面使用```-k```覆盖相应的配置。

####域名属性

每一个使用```cf push```部署应用程序到特定Cloud Foundry服务实例，每一个Cloud Foundry服务实例可能都有一个有管理员配置的一个共享的域名。如果你不修改此默认域名，Cloud Foundry路由就会使用此域名把请求分发到你的应用程序。

你可以使用```domain```属性自定义你想要的域名而不使用默认域名。

```
---
  ...
  domain: unique-example.com
```

在命令行选项里面使用```-d```覆盖相应的配置。

####多个域名属性

使用```domains```属性指定多个域名配置。如果你同时使用```domain```和```domains```属性，Cloud Foundry会使用这两种配置的域名来做路由分发。

```
---
  ...
  domains:
  - domain-example1.com
  - domain-example2.org
```

命令行选项里面使用```-d```覆盖相应的配置。

####服务实例数量属性


####内存属性


####主机属性